services:
  carla-server:
    image: carlasim/carla:0.9.15
    command: /bin/bash -c "./CarlaUE4.sh -vulkan -RenderOffScreen -nosound"
    ports:
      - "2000-2002:2000-2002"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  carla-client:
    image: carla-pipeline-client
    depends_on:
      - carla-server
    environment:
      - CARLA_HOST=carla-server
      - AWS_BUCKET_NAME=your-s3-bucket-name
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]